[databases]
; Configuración de la base de datos backend
; NOTA: Esta sección se sobrescribe por la variable de entorno PGBOUNCER_DATABASES
; en docker-compose.yml. Este archivo sirve como fallback si no se define la variable.
* = host=postgres-prod port=5432 dbname=apygg user=apygg password=secret

[pgbouncer]
; Configuración general de PgBouncer

; Modo de pooling: transaction (recomendado para Laravel)
; transaction: permite transacciones completas, compatible con Eloquent
; session: mantiene conexión durante toda la sesión (no recomendado)
; statement: muy restrictivo, solo una query por conexión (no recomendado)
pool_mode = transaction

; Configuración de pool
default_pool_size = 25
max_client_conn = 100
min_pool_size = 5
reserve_pool_size = 5
reserve_pool_timeout = 3

; Configuración de autenticación
; md5: compatible con PostgreSQL estándar
; scram-sha-256: más seguro, requiere PostgreSQL 10+
; NOTA: Se sobrescribe por PGBOUNCER_AUTH_TYPE en docker-compose.yml
auth_type = md5
auth_file = /etc/pgbouncer/userlist.txt

; Archivo de usuarios (opcional, se puede usar variables de entorno)
; Si no existe, PgBouncer usará las credenciales del backend directamente

; Configuración de logging
; NOTA: Se sobrescribe por variables PGBOUNCER_LOGFILE y PGBOUNCER_PIDFILE
logfile = /var/log/pgbouncer/pgbouncer.log
pidfile = /var/run/pgbouncer/pgbouncer.pid
; NOTA: Se sobrescribe por PGBOUNCER_ADMIN_USERS y PGBOUNCER_STATS_USERS
admin_users = apygg
stats_users = apygg

; Configuración de red
listen_addr = 0.0.0.0
listen_port = 6432

; Timeouts
server_idle_timeout = 600
server_connect_timeout = 15
server_login_retry = 15
query_timeout = 0
query_wait_timeout = 120
client_idle_timeout = 0
client_login_timeout = 60
autodb_idle_timeout = 3600

; Configuración de seguridad
ignore_startup_parameters = extra_float_digits

; Configuración de performance
server_round_robin = 0
application_name_add_host = 1
